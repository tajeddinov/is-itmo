1.	Остаться на WildFly, но сделать нестандартную интеграцию: не через /subsystem=datasources, а через DBCP2
BasicManagedDataSource, который подключается к TransactionManager WildFly и бросается в JNDI. Это будет работать,
но это хак (не “поддерживаемый” путь WildFly).

2.	Перейти на Apache TomEE, где DBCP исторически поддержан как пул (и настраивается как ресурс), и JTA/EJB/JPA —
нативная часть стека TomEE/OpenEJB. В их доках прямо говорится про pool “dbcp for OpenEJB by default…” и про
JTA-managed datasource.  ￼

Почему обычным способом на WildFly “поменять пул” нельзя

WildFly datasource из подсистемы datasources — это JCA/IronJacamar managed datasource. Ты можешь тюнить параметры,
но “заменить реализацию пула на DBCP2” штатно нельзя (это другой механизм). Поэтому мы обходим datasources и
публикуем в JNDI наш DataSource. (Да, звучит странно — но требования у тебя тоже специфические.)


cd apache-tomee-*/bin
./startup.sh

Положи JDBC-драйвер (например postgresql-*.jar) в:
apache-tomee-*/lib/

Создай/отредактируй файл:
apache-tomee-*/conf/tomee.xml

Пример (PostgreSQL), JTA включено и пул = DBCP:

<tomee>
  <Resource id="jdbc/MyDS" type="DataSource">
    JdbcDriver org.postgresql.Driver
    JdbcUrl jdbc:postgresql://localhost:5432/mydb
    UserName myuser
    Password mypass

    JtaManaged true

    # ВАЖНО: заставляем TomEE использовать Apache Commons DBCP
    DataSourceCreator dbcp

    # типичные DBCP2 параметры пула
    maxTotal 30
    minIdle 3
    maxIdle 10
    maxWaitMillis 5000
    testOnBorrow true
    validationQuery SELECT 1
  </Resource>

  <!-- Нужен ещё non-jta datasource (TomEE прямо рекомендует задавать оба) -->
  <Resource id="jdbc/MyDSUnmanaged" type="DataSource">
    JdbcDriver org.postgresql.Driver
    JdbcUrl jdbc:postgresql://localhost:5432/mydb
    UserName myuser
    Password mypass

    JtaManaged false
    DataSourceCreator dbcp

    maxTotal 10
    testOnBorrow true
    validationQuery SELECT 1
  </Resource>
</tomee>


persistence.xml под TomEE

<persistence-unit name="MyPU" transaction-type="JTA">
  <jta-data-source>java:openejb/Resource/jdbc/MyDS</jta-data-source>
  <non-jta-data-source>java:openejb/Resource/jdbc/MyDSUnmanaged</non-jta-data-source>

  <!-- Если ты хочешь оставить Hibernate -->
  <provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>

  <properties>
    <!-- твои hibernate props -->
  </properties>
</persistence-unit>



добавить юзера:
apache-tomee-*/conf/tomcat-users.xml
<tomcat-users>
  <role rolename="manager-gui"/>
  <role rolename="manager-script"/>
  <role rolename="manager-status"/>

  <user username="admin" password="CHANGE_ME" roles="manager-gui,manager-script,manager-status"/>
</tomcat-users>