ssh -L 21201:127.0.0.1:21201 -L 21202:127.0.0.1:21202 -L 22821:127.0.0.1:22821 -L 5432:127.0.0.1:5432 se

scp -P 2222 -r frontend/dist/* se:/home/studs/s409659/is/www
scp -P 2222 -r build/libs/app.war se:/home/studs/s409659/is/wildfly-37.0.1.Final/standalone/deployments

nginx
sh ~/is/wildfly-37.0.1.Final/bin/standalone.sh

nginx -t
nginx -s reload
sudo nginx -s quit
sudo nginx -s stop



ssh  se
httpd -f ~/is/httpd.conf -k start
export _JAVA_OPTIONS="-Xmx1g -XX:MaxMetaspaceSize=256m -Xss256k -XX:ActiveProcessorCount=1"
sh ~/is/wildfly-37.0.1.Final/bin/standalone.sh


---


tar -xzf wildfly-37.0.1.Final.tar.gz

sh $JBOSS_HOME/bin/add-user.sh

–ø–æ–º–µ–Ω—è—Ç—å –ø–æ—Ä—Ç—ã –≤ standalone/configuration/standalone.xml

sh $JBOSS_HOME/bin/standalone.sh

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞ PostgreSQL –∫–∞–∫ –º–æ–¥—É–ª—å WildFly:
–°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å —Å –¥—Ä–∞–π–≤–µ—Ä–æ–º:

$JBOSS_HOME/modules/system/layers/base/org/postgresql/main/

—Å—é–¥–∞ –Ω–∞–¥–æ –ø–æ–ª–æ–∂–∏—Ç—å postgresql-42.7.4.jar –∏ —Ñ–∞–π–ª module.xml
module.xml (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π):

<?xml version="1.0" encoding="UTF-8"?>
<module xmlns="urn:jboss:module:1.9" name="org.postgresql">
  <resources>
    <resource-root path="postgresql-42.7.4.jar"/>
  </resources>
  <dependencies>
    <module name="java.se"/>
  </dependencies>
</module>


–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥—Ä–∞–π–≤–µ—Ä –≤ –ø–æ–¥—Å–∏—Å—Ç–µ–º–µ datasources (CLI):

$JBOSS_HOME/bin/jboss-cli.sh --connect \
--controller=127.0.0.1:21202 \
"/subsystem=datasources/jdbc-driver=postgresql:add(driver-name=postgresql,driver-module-name=org.postgresql,driver-class-name=org.postgresql.Driver)"

–°–æ–∑–¥–∞–Ω–∏–µ DataSource (JNDI)

$JBOSS_HOME/bin/jboss-cli.sh --connect \
--controller=127.0.0.1:21202 \
"data-source add --name=StudsDS --jndi-name=java:/jdbc/studs \
 --driver-name=postgresql \
 --connection-url=jdbc:postgresql://localhost:5432/studs \
 --user-name=s409659 --password=boc6V3nPz0Ei8NvB \
 --min-pool-size=2 --max-pool-size=20 --use-ccm=true --enabled=true"

–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:

$JBOSS_HOME/bin/jboss-cli.sh --connect \
--controller=127.0.0.1:21202 \
"/subsystem=datasources/data-source=StudsDS:test-connection-in-pool"



------------------------------------------------------------------------------------------------------------------------



1) persistence unit —Å –∏–º–µ–Ω–µ–º studsPU –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å –º–Ω–µ —Å–∞–º–æ–º—É –≤ wildfly?
2) persistence.xml –æ–ø–∏—Å—ã–≤–∞–µ—Ç JTA-—é–Ω–∏—Ç, –∞ –∫–∞–∫–∏–µ –µ—â–µ –µ—Å—Ç—å? –µ—Å—Ç—å data-source, –µ—Å—Ç—å JTA-—é–Ω–∏—Ç -- —á—Ç–æ —ç—Ç–æ –≤—Å–µ? —ç—Ç–æ –ø—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –±–¥ —á–µ—Ä–µ–∑ orm? -- —Ä–∞–∑–ª–æ–∂–∏ –≤—Å–µ –Ω–∞ —Å–≤–æ–∏ –º–µ—Å—Ç–∞, –∞—Ç–æ –∫–∞—à–∞ –≤ –≥–æ–ª–æ–≤–µ
3) JTA - —ç—Ç–æ —á—Ç–æ —Ç–∞–∫–æ–µ –≤ —ç—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ?
ChatGPT —Å–∫–∞–∑–∞–ª:

–û—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–µ –≤–æ–ø—Ä–æ—Å—ã üëç
–î–∞–≤–∞–π –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Ä–∞–∑–ª–æ–∂–∏–º –≤—Å—ë –ø–æ –ø–æ–ª–æ—á–∫–∞–º, –ø–æ—Ç–æ–º—É —á—Ç–æ —É –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Ç—É—Ç —Ç–æ–∂–µ –∫–∞—à–∞ –ø–æ–ª—É—á–∞–µ—Ç—Å—è.

1) –ù—É–∂–Ω–æ –ª–∏ —Å–∞–º–æ–º—É —Å–æ–∑–¥–∞–≤–∞—Ç—å persistence unit studsPU –≤ WildFly?

–ù–µ—Ç.
persistence.xml –≤—Ö–æ–¥–∏—Ç –≤ —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç –∏ –∏–º–µ–Ω–Ω–æ —Ç–∞–º —Ç—ã –æ–±—ä—è–≤–ª—è–µ—à—å persistence unit (PU).
WildFly (–∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä) –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–∏—Ç–∞–µ—Ç META-INF/persistence.xml, –≤–∏–¥–∏—Ç <persistence-unit name="studsPU"> –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –µ–≥–æ.

–¢–æ –µ—Å—Ç—å persistence unit —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ persistence.xml.
–¢–µ–±–µ –Ω—É–∂–Ω–æ –ª–∏—à—å –¥–∞—Ç—å DataSource —á–µ—Ä–µ–∑ JNDI (–Ω–∞–ø—Ä–∏–º–µ—Ä java:/jdbc/studs), –∞ PU —É–∂–µ ‚Äú—Å–≤—è–∂–µ—Ç—Å—è‚Äù —Å –Ω–∏–º.

2) –ö–∞–∫–∏–µ –±—ã–≤–∞—é—Ç persistence unit?

–í persistence.xml –µ—Å—Ç—å –∫–ª—é—á transaction-type.
–ï—Å—Ç—å –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞:

üîπ A) JTA persistence unit
<persistence-unit name="studsPU" transaction-type="JTA">
    <jta-data-source>java:/jdbc/studs</jta-data-source>
</persistence-unit>


–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä-—É–ø—Ä–∞–≤–ª—è–µ–º—ã–π DataSource (—á–µ—Ä–µ–∑ JNDI).

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (JTA ‚Äî Java Transaction API).

–†–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ —Å @PersistenceContext ‚Üí EntityManager –∏–Ω–∂–µ–∫—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º (CMT).

–≠—Ç–æ "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π" –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (WildFly, Payara, GlassFish –∏ —Ç.–¥.).

DataSource –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ —Å–∞–º–æ–º —Å–µ—Ä–≤–µ—Ä–µ (—á–µ—Ä–µ–∑ standalone.xml –∏–ª–∏ –∞–¥–º–∏–Ω–∫—É).

üîπ B) RESOURCE_LOCAL persistence unit
<persistence-unit name="studsPU" transaction-type="RESOURCE_LOCAL">
    <provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>
    <properties>
        <property name="jakarta.persistence.jdbc.url" value="jdbc:postgresql://localhost:5432/studs"/>
        <property name="jakarta.persistence.jdbc.user" value="user"/>
        <property name="jakarta.persistence.jdbc.password" value="pass"/>
    </properties>
</persistence-unit>


–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è –ø—Ä—è–º–æ –≤ persistence.xml.

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ ‚Äî –≤—Å—ë –¥–µ–ª–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é (EntityManagerFactory, em.getTransaction().begin() –∏ —Ç.–¥.).

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è standalone-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (Java SE, –¥–µ—Å–∫—Ç–æ–ø, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –±–µ–∑ Java EE –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –≤ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –Ω–æ —Ç–æ–≥–¥–∞ —Ç–µ—Ä—è–µ—à—å —Ñ–∏—á–∏ JTA (–ø—É–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ø—Ä.).

3) –ß—Ç–æ —Ç–∞–∫–æ–µ JTA –≤ —ç—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ?

JTA (Java Transaction API) ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –≤ Java EE / Jakarta EE.

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ:

–ö–æ–≥–¥–∞ PU –æ–±—ä—è–≤–ª–µ–Ω –∫–∞–∫ transaction-type="JTA", —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (WildFly).

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:

—Ç–µ–±–µ –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –¥–µ–ª–∞—Ç—å em.getTransaction().begin() –∏ commit() –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö —Å @Stateless;

–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–∞–º –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ –Ω–∞—á–∞–ª–µ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ EJB –∏ –∫–æ–º–º–∏—Ç–∏—Ç/–æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –≤ –∫–æ–Ω—Ü–µ;

–º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, PostgreSQL + JMS) –≤ –æ–¥–Ω—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (XA).

–¢–æ –µ—Å—Ç—å JTA = —Å–ª–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –∑–∞ —Ç–µ–±—è.

–ß—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∫–∞—à–∏ ‚Äî –ø—Ä–æ—Å—Ç–∞—è —Å—Ö–µ–º–∞:

DataSource (JNDI-–ø—É–ª) ‚Äî —ç—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ, –∫–æ—Ç–æ—Ä—ã–º —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
–¢—ã –µ–≥–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—à—å –≤ WildFly (–∏–º—è java:/jdbc/studs).

Persistence Unit (PU) ‚Äî —ç—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è JPA (–∫–∞–∫–∏–µ –∫–ª–∞—Å—Å—ã ‚Äî —Å—É—â–Ω–æ—Å—Ç–∏, –∫–∞–∫–æ–π DataSource –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ –æ–ø—Ü–∏–∏ Hibernate/EclipseLink).
–û–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ persistence.xml.

EntityManager ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç API JPA, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –¥–µ–ª–∞–µ—à—å CRUD.
–û–Ω —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ PU –∏ –∏–Ω–∂–µ–∫—Ç–∏—Ç—Å—è —á–µ—Ä–µ–∑ @PersistenceContext.

JTA ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
–û–Ω–∞ "–æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç" –≤—ã–∑–æ–≤—ã EntityManager –∏ –¥—Ä—É–≥–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π, —á—Ç–æ–±—ã —Ç–µ–±–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å begin/commit/rollback.

üëâ –ò—Ç–æ–≥:

–î–ª—è WildFly/GlassFish/Payara ‚Üí –≤—Å–µ–≥–¥–∞ –±–µ—Ä–∏ JTA PU + JNDI DataSource.

–î–ª—è Java SE (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞) ‚Üí —Ç–æ–≥–¥–∞ —Ç–æ–ª—å–∫–æ RESOURCE_LOCAL PU.



------------------------------------------------------------------------------------------------------------------------






–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç @PersistenceContext(unitName = "studsPU")?

–≠—Ç–æ –∏–Ω—ä–µ–∫—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä-—É–ø—Ä–∞–≤–ª—è–µ–º–æ–≥–æ EntityManager (JTA-EntityManager) –¥–ª—è persistence unit‚Äô–∞ —Å –∏–º–µ–Ω–µ–º studsPU.

–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∞—à persistence.xml –æ–ø–∏—Å—ã–≤–∞–µ—Ç JTA-—é–Ω–∏—Ç (transaction-type="JTA") –∏ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π DataSource (JNDI).

–° RESOURCE_LOCAL –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: —Ç–∞–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Å–æ–∑–¥–∞–µ—Ç JTA-EntityManager. –î–ª—è RESOURCE_LOCAL –∏—Å–ø–æ–ª—å–∑—É—é—Ç @PersistenceUnit + EntityManagerFactory –∏ —Ä—É—á–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ EntityManager –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚Äî –≤ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —ç—Ç–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è.

–í—ã–≤–æ–¥: –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø–∏—Å–∞—Ç—å @PersistenceContext, –ø–µ—Ä–µ–≤–æ–¥–∏—Ç–µ PU –Ω–∞ JTA + JNDI DataSource.

–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è WildFly (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
1) –°–¥–µ–ª–∞—Ç—å JTA-–ø—É–ª –≤ WildFly (JNDI DataSource)

–ß–µ—Ä–µ–∑ CLI (–ø—Ä–∏–º–µ—Ä):

# 1) –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å –¥—Ä–∞–π–≤–µ—Ä–∞ PostgreSQL (–æ–¥–∏–Ω —Ä–∞–∑)
$JBOSS_HOME/bin/jboss-cli.sh --connect \
"module add --name=org.postgresql --resources=/path/to/postgresql-42.7.4.jar --dependencies=jakarta.xml.bind.api,java.naming,javax.api"

# 2) –û–±—ä—è–≤–∏—Ç—å JDBC-–¥—Ä–∞–π–≤–µ—Ä –≤ –ø–æ–¥—Å–∏—Å—Ç–µ–º–µ datasources
$JBOSS_HOME/bin/jboss-cli.sh --connect \
"/subsystem=datasources/jdbc-driver=postgresql:add(driver-name=postgresql,driver-module-name=org.postgresql,driver-class-name=org.postgresql.Driver)"

# 3) –°–æ–∑–¥–∞—Ç—å DataSource
$JBOSS_HOME/bin/jboss-cli.sh --connect \
"data-source add --name=StudsDS --jndi-name=java:/jdbc/studs \
 --driver-name=postgresql \
 --connection-url=jdbc:postgresql://localhost:5432/studs \
 --user-name=s409659 --password=boc6V3nPz0Ei8NvB \
 --min-pool-size=2 --max-pool-size=20 --use-ccm=true --enabled=true"


(–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ Admin Console: Configuration ‚Üí Subsystems ‚Üí Datasources & Drivers.)

2) persistence.xml –ø–æ–¥ JTA
<?xml version="1.0" encoding="UTF-8"?>
<persistence xmlns="https://jakarta.ee/xml/ns/persistence" version="3.1">
  <persistence-unit name="studsPU" transaction-type="JTA">
    <!-- –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å: WildFly —Å–∞–º –ø–æ–¥—Å—Ç–∞–≤–∏—Ç Hibernate -->
    <provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>

    <!-- —Å—Å—ã–ª–∫–∞ –Ω–∞ JNDI DataSource, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤ —à–∞–≥–µ 1 -->
    <jta-data-source>java:/jdbc/studs</jta-data-source>

    <class>ru.itmo.isitmolab.model.Vehicle</class>

    <properties>
      <!-- —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã -->
      <property name="jakarta.persistence.schema-generation.database.action" value="create-or-extend-tables"/>
      <!-- –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∂–µ–ª–∞–Ω–∏—é -->
      <property name="hibernate.show_sql" value="true"/>
      <property name="hibernate.format_sql" value="true"/>
    </properties>
  </persistence-unit>
</persistence>


–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –Ω–∏–∫–∞–∫–∏—Ö jakarta.persistence.jdbc.* —Å–≤–æ–π—Å—Ç–≤ –∏ –Ω–∏–∫–∞–∫–∏—Ö -Ddb.* JVM-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ –Ω—É–∂–Ω–æ ‚Äî –≤—Å—ë –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–≥–æ DataSource.

3) –ë–∏–Ω—ã

–¢–µ–ø–µ—Ä—å @PersistenceContext(unitName="studsPU") –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω–∂–µ–∫—Ç–∏—Ç—å JTA-EntityManager:

@Stateless
public class VehicleDao {
    @PersistenceContext(unitName = "studsPU")
    private EntityManager em;
    // CRUD...
}


–ò —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (CMT) ‚Äî –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é begin/commit.

4) –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Gradle

–õ—É—á—à–µ –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ —Ç–æ, —á—Ç–æ —É–∂–µ –≤ WildFly:

dependencies {
    compileOnly 'jakarta.platform:jakarta.jakartaee-web-api:11.0.0'
    // Hibernate ORM (–ø—Ä–æ–≤–∞–π–¥–µ—Ä JPA) —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω –≤ WildFly ‚Üí –Ω–µ —Ç–∞—â–∏–º –≤ WAR
    // –î—Ä–∞–π–≤–µ—Ä Postgres –¥–∞—ë—Ç —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å ‚Üí –Ω–µ —Ç–∞—â–∏–º –≤ WAR

    compileOnly 'org.projectlombok:lombok:1.18.34'
    annotationProcessor 'org.projectlombok:lombok:1.18.34'
}


–ï—Å–ª–∏ –ø–æ–ª–æ–∂–∏—Ç–µ hibernate-core –≤ WAR, –º–æ–∂–Ω–æ —Å–ª–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º –º–æ–¥—É–ª–µ–º. –õ—É—á—à–µ –Ω–µ –Ω—É–∂–Ω–æ.

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ RESOURCE_LOCAL

–≠—Ç–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –≤ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ:

persistence.xml –∫–∞–∫ —É –≤–∞—Å —Å–µ–π—á–∞—Å (jdbc.url/user/password + RESOURCE_LOCAL).

–í –∫–æ–¥–µ –Ω–µ @PersistenceContext, –∞:

@PersistenceUnit(unitName = "studsPU")
private EntityManagerFactory emf;

// –∞ –¥–∞–ª—å—à–µ –≤—Ä—É—á–Ω—É—é:
EntityManager em = emf.createEntityManager();
EntityTransaction tx = em.getTransaction();
tx.begin();
// ...
tx.commit();
em.close();


–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî —Ä—É—á–Ω—ã–µ, DataSource ‚Äî –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ persistence.xml/JVM-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, JNDI-–ø—É–ª –Ω–µ –Ω—É–∂–µ–Ω.

–ú–∏–Ω—É—Å—ã: –≤—ã –æ–±—Ö–æ–¥–∏—Ç–µ—Å—å –±–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –ø—É–ª–∞ EM, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ —Ç.–ø. –ù–∞ WildFly –ª—É—á—à–µ JTA + JNDI.

–û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä—è–º–æ:

–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç @PersistenceContext(unitName = "studsPU")?
–ò–Ω—ä–µ–∫—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–≥–æ (JTA) EntityManager –¥–ª—è PU studsPU. –¢—Ä–µ–±—É–µ—Ç transaction-type="JTA" –∏ <jta-data-source>.

–ù–∞–¥–æ –ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å JNDI pool —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ WildFly?
–î–∞, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –≤ Java EE –ø—Ä–∏–Ω—è—Ç–æ: —Å–æ–∑–¥–∞–π—Ç–µ JDBC DataSource –≤ WildFly (JNDI, –Ω–∞–ø—Ä. java:/jdbc/studs), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –≤ <jta-data-source>. –¢–æ–≥–¥–∞ @PersistenceContext –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–æ–∑—å–º–µ—Ç –Ω–∞ —Å–µ–±—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –¥–∞–º –≥–æ—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã CLI –∏–º–µ–Ω–Ω–æ –ø–æ–¥ —Ç–≤–æ—é —É—Å—Ç–∞–Ω–æ–≤–∫—É WildFly (–≤–µ—Ä—Å–∏—é/–ø—É—Ç—å), –∏–ª–∏ –ø–æ–º–æ–≥—É –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π DAO/Service –Ω–∞ JTA-EntityManager c –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∫–∞–º–∏.